{
  "project": "False Witness",
  "branchName": "ralph/map-entity",
  "description": "First playable map (Abandoned House) and voice-reactive Listener entity",
  "tickets": ["FW-071", "FW-046"],
  "userStories": [
    {
      "id": "FW-071-01",
      "title": "Create map scene structure",
      "description": "Set up abandoned house scene hierarchy",
      "acceptanceCriteria": [
        "Create scenes/maps/abandoned_house.tscn (Node3D root)",
        "Add Rooms (Node3D) container for room geometry",
        "Add Spawns (Node3D) for player spawn points",
        "Add Lighting (Node3D) for light fixtures",
        "Add Navigation (NavigationRegion3D) for entity pathfinding",
        "Add EvidencePoints (Node3D) for evidence spawn markers",
        "Scene loads without errors",
        "gdlint scenes/ passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "File: scenes/maps/abandoned_house.tscn"
    },
    {
      "id": "FW-071-02",
      "title": "Design floor plan layout",
      "description": "Create 8-12 room layout document",
      "acceptanceCriteria": [
        "Create docs/maps/abandoned_house_layout.md",
        "Document room names and purposes",
        "Include floor plan sketch (ASCII or image)",
        "Mark entry points, connecting hallways",
        "Mark hiding spot locations",
        "Mark evidence spawn areas per room",
        "gdlint passes (no code changes)"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Design first, build second. Small house: living room, kitchen, 2 bedrooms, bathroom, basement, attic."
    },
    {
      "id": "FW-071-03",
      "title": "Create entrance/spawn area",
      "description": "Build starting area where players spawn",
      "acceptanceCriteria": [
        "Create entryway room with door to outside",
        "Add 4-6 spawn points (Position3D markers)",
        "Spawn points spaced to avoid overlap",
        "Clear sightlines for initial team gathering",
        "Door to rest of house clearly visible",
        "gdlint scenes/ passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Players spawn here at investigation start"
    },
    {
      "id": "FW-071-04",
      "title": "Build living room",
      "description": "Main gathering room of house",
      "acceptanceCriteria": [
        "Create living room with CSG or imported mesh",
        "PS1/PS2 aesthetic: low-poly, simple textures",
        "Add placeholder furniture: couch, chairs, TV stand",
        "Connect to entryway and kitchen",
        "Add light fixture with switch",
        "Add 2-3 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Low-poly models; vertex colors or 256x256 textures"
    },
    {
      "id": "FW-071-05",
      "title": "Build kitchen",
      "description": "Kitchen with interactable elements",
      "acceptanceCriteria": [
        "Create kitchen room geometry",
        "Add placeholder furniture: cabinets, table, chairs",
        "Add interactable drawers/cabinets (open/close)",
        "Connect to living room and hallway",
        "Add light fixture with switch",
        "Add 2-3 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Cabinets can be opened for hiding spots"
    },
    {
      "id": "FW-071-06",
      "title": "Build master bedroom",
      "description": "Large bedroom with hiding spots",
      "acceptanceCriteria": [
        "Create bedroom room geometry",
        "Add placeholder furniture: bed, dresser, nightstands",
        "Add closet with interactable door (hiding spot)",
        "Add under-bed hiding spot",
        "Connect to upstairs hallway",
        "Add light fixture with switch",
        "Add 2-3 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Primary hiding location for hunts"
    },
    {
      "id": "FW-071-07",
      "title": "Build second bedroom",
      "description": "Smaller bedroom",
      "acceptanceCriteria": [
        "Create smaller bedroom geometry",
        "Add placeholder furniture: bed, desk",
        "Add closet hiding spot",
        "Connect to upstairs hallway",
        "Add light fixture with switch",
        "Add 2 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Potential entity favorite room"
    },
    {
      "id": "FW-071-08",
      "title": "Build bathroom",
      "description": "Bathroom with mirror interactions",
      "acceptanceCriteria": [
        "Create bathroom room geometry",
        "Add placeholder fixtures: toilet, sink, bathtub/shower",
        "Add mirror (potential manifestation surface)",
        "Add light fixture with switch",
        "Connect to upstairs hallway",
        "Add 2 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Mirror can show writing manifestations"
    },
    {
      "id": "FW-071-09",
      "title": "Build basement",
      "description": "Dark basement area",
      "acceptanceCriteria": [
        "Create basement room geometry",
        "Stairs from main floor",
        "Darker lighting than rest of house",
        "Add storage items, shelving",
        "Add 1-2 hiding spots behind shelves",
        "Add light fixture with switch (dim)",
        "Add 3-4 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "High tension area; common entity spawn"
    },
    {
      "id": "FW-071-10",
      "title": "Build attic",
      "description": "Cramped attic space",
      "acceptanceCriteria": [
        "Create attic room geometry with sloped ceiling",
        "Access via pull-down ladder or stairs",
        "Cramped, limited visibility",
        "Add storage boxes, old furniture",
        "No light fixture (flashlight required)",
        "Add 2-3 evidence spawn points",
        "gdlint scenes/ passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Scary location; limited escape routes"
    },
    {
      "id": "FW-071-11",
      "title": "Build connecting hallways",
      "description": "Hallways connecting rooms",
      "acceptanceCriteria": [
        "Create main floor hallway connecting rooms",
        "Create upstairs hallway connecting bedrooms/bathroom",
        "Add staircase between floors",
        "Hallways narrow for tension",
        "Add light fixtures in hallways",
        "gdlint scenes/ passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Tight corridors per GDD guidance"
    },
    {
      "id": "FW-071-12",
      "title": "Create Door interactable",
      "description": "Doors that open/close",
      "acceptanceCriteria": [
        "Create scenes/interactables/door.tscn extending Interactable",
        "Add open/close animation (rotate on hinge)",
        "Toggle state on interaction",
        "Door blocks line of sight when closed",
        "Sound effect on open/close",
        "Network sync door state",
        "gdlint src/ scenes/ passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Files: scenes/interactables/door.tscn, src/interactables/door.gd"
    },
    {
      "id": "FW-071-13",
      "title": "Create LightSwitch interactable",
      "description": "Light switches to toggle room lights",
      "acceptanceCriteria": [
        "Create scenes/interactables/light_switch.tscn",
        "Toggle linked light fixture on interaction",
        "Visual indicator of switch state",
        "Sound effect on toggle",
        "Network sync light state",
        "gdlint src/ scenes/ passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Files: scenes/interactables/light_switch.tscn, src/interactables/light_switch.gd"
    },
    {
      "id": "FW-071-14",
      "title": "Set up HidingSpot nodes",
      "description": "Configure hiding spots in each room",
      "acceptanceCriteria": [
        "Add HidingSpot nodes at closet locations",
        "Add HidingSpot nodes under beds",
        "Add HidingSpot nodes behind large furniture",
        "Configure each spot's capacity (1 player)",
        "Configure detection difficulty per spot",
        "gdlint scenes/ passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "HidingSpot class exists in src/entity/hiding_spot.gd"
    },
    {
      "id": "FW-071-15",
      "title": "Create NavigationMesh for entity pathfinding",
      "description": "Bake NavMesh for entity AI movement",
      "acceptanceCriteria": [
        "Configure NavigationRegion3D in map scene",
        "Set agent radius appropriate for entity size",
        "Bake navigation mesh covering all walkable areas",
        "Exclude furniture, walls from walkable area",
        "Doors create navigation links when open",
        "Test pathfinding between rooms",
        "gdlint scenes/ passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Entity uses NavigationAgent3D for movement"
    },
    {
      "id": "FW-071-16",
      "title": "Configure evidence spawn points",
      "description": "Place markers for evidence spawning",
      "acceptanceCriteria": [
        "Create EvidenceSpawnPoint marker scene",
        "Place 2-4 markers per room",
        "Markers indicate valid evidence placement",
        "Configure evidence type compatibility per point",
        "Export spawn points for EntityManager access",
        "gdlint src/ scenes/ passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "EntityManager randomly selects spawn points"
    },
    {
      "id": "FW-071-17",
      "title": "Configure entity favorite room",
      "description": "Designate room as entity's preferred location",
      "acceptanceCriteria": [
        "Add 'favorite_room' property to map configuration",
        "Export room list for random selection",
        "Entity spawns and returns to favorite room",
        "Evidence more likely in favorite room",
        "UI can reference favorite room for clues",
        "gdlint src/ passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Random selection at match start"
    },
    {
      "id": "FW-071-18",
      "title": "Add ambient lighting",
      "description": "Base lighting for atmosphere",
      "acceptanceCriteria": [
        "Add WorldEnvironment with dark ambient",
        "Configure sky/environment for nighttime",
        "Add subtle ambient occlusion",
        "Test visibility with flashlight off",
        "Atmosphere should feel creepy/dark",
        "gdlint scenes/ passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Horror atmosphere; flashlight should feel necessary"
    },
    {
      "id": "FW-071-19",
      "title": "Add room light fixtures",
      "description": "Place light sources in each room",
      "acceptanceCriteria": [
        "Add OmniLight3D or SpotLight3D per room",
        "Lights toggleable via light switches",
        "Configure light colors for warm indoor feel",
        "Lights create shadows when enabled",
        "Default state: some lights on, some off",
        "gdlint scenes/ passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Vertex lighting style for PS1/PS2 aesthetic"
    },
    {
      "id": "FW-071-20",
      "title": "Add collision shapes to all geometry",
      "description": "Physics collision for walls/floors/objects",
      "acceptanceCriteria": [
        "All walls have collision shapes",
        "All floors have collision shapes",
        "Furniture has appropriate collision",
        "Player cannot walk through geometry",
        "Raycast interactions work correctly",
        "gdlint scenes/ passes"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Layer 1 (World) for static geometry"
    },
    {
      "id": "FW-071-21",
      "title": "Create map loading system",
      "description": "Load map scene for investigation",
      "acceptanceCriteria": [
        "Add load_map(map_name: String) to GameManager",
        "Map loads when transitioning to INVESTIGATION",
        "Players spawned at map spawn points",
        "Map resources loaded asynchronously",
        "Loading screen during map load",
        "gdlint src/ passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Only one map for now; future expansion"
    },
    {
      "id": "FW-071-22",
      "title": "Write integration tests for map functionality",
      "description": "Test map systems work correctly",
      "acceptanceCriteria": [
        "Create tests/integration/test_abandoned_house.gd",
        "Test spawn point validity",
        "Test door interaction",
        "Test light switch interaction",
        "Test NavMesh connectivity",
        "Test hiding spot accessibility",
        "All tests pass",
        "gdlint tests/ passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": "File: tests/integration/test_abandoned_house.gd"
    },
    {
      "id": "FW-046-01",
      "title": "Create Listener entity class",
      "description": "Entity that reacts to player voice",
      "acceptanceCriteria": [
        "Create src/entity/entities/listener.gd extending Entity",
        "Set entity_name = 'Listener'",
        "Configure evidence types: FREEZING_TEMPERATURE, GHOST_WRITING, AURA_PATTERN",
        "Add voice_sensitivity: float property",
        "Override behavioral methods for voice reactivity",
        "gdlint src/ passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": "File: src/entity/entities/listener.gd. Entity base class in src/entity/entity.gd"
    },
    {
      "id": "FW-046-02",
      "title": "Define Listener dormant phase",
      "description": "State where Listener waits for voice trigger",
      "acceptanceCriteria": [
        "Add is_dormant: bool property",
        "Listener alternates between dormant and active",
        "Dormant duration: 30-60 seconds (random)",
        "During dormant, Listener is stationary",
        "Active duration: 60-120 seconds",
        "gdlint src/ passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": "Dormant = listening for voice; active = normal behavior"
    },
    {
      "id": "FW-046-03",
      "title": "Implement voice detection trigger",
      "description": "Listener hunts when players speak loudly during dormant",
      "acceptanceCriteria": [
        "Connect to VoiceManager.voice_activity signal",
        "When dormant and voice_amplitude > threshold, trigger hunt",
        "Threshold: above whisper volume",
        "Voice-triggered hunt bypasses sanity requirement",
        "Log voice trigger for debugging",
        "gdlint src/ passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": "Core mechanic: silence is survival"
    },
    {
      "id": "FW-046-04",
      "title": "Implement instant hunt on voice trigger",
      "description": "Voice-triggered hunt has no warning phase",
      "acceptanceCriteria": [
        "Voice-triggered hunt skips WARNING phase",
        "Hunt begins immediately (ACTIVE phase)",
        "Listener targets speaking player",
        "Normal hunt cooldown applies after",
        "gdlint src/ passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": "No warning = high danger"
    },
    {
      "id": "FW-046-05",
      "title": "Add dormant phase audio indicator",
      "description": "Subtle sound when Listener is dormant",
      "acceptanceCriteria": [
        "Play faint static/hum sound when dormant",
        "Sound audible within 10m of Listener",
        "Spatial audio (louder when closer)",
        "Sound stops when Listener becomes active",
        "Players can learn to detect dormant state",
        "gdlint src/ passes"
      ],
      "priority": 27,
      "passes": false,
      "notes": "Teaches players when silence is critical"
    },
    {
      "id": "FW-046-06",
      "title": "Implement Listener normal behavior",
      "description": "Behavior when not dormant or hunting",
      "acceptanceCriteria": [
        "During active phase, Listener roams slowly",
        "Occasional manifestations and interactions",
        "Responds to Ghost Writing Book in active phase",
        "Creates FREEZING_TEMPERATURE zones in favorite room",
        "gdlint src/ passes"
      ],
      "priority": 28,
      "passes": false,
      "notes": "Standard entity behavior between dormant phases"
    },
    {
      "id": "FW-046-07",
      "title": "Implement Listener hunt behavior",
      "description": "How Listener hunts players",
      "acceptanceCriteria": [
        "Listener moves toward last heard voice location",
        "Speed: moderate (not fastest, not slowest)",
        "Continues hunting for standard duration",
        "Can target other players if initial target escapes",
        "Hunt ends normally when duration expires",
        "gdlint src/ passes"
      ],
      "priority": 29,
      "passes": false,
      "notes": "Voice source is initial target"
    },
    {
      "id": "FW-046-08",
      "title": "Add Listener behavioral tell",
      "description": "Observable behavior that identifies Listener",
      "acceptanceCriteria": [
        "Listener responds to voice more than other stimuli",
        "During active phase, pauses when players talk",
        "Turns toward voice source (tracking behavior)",
        "Players can test for Listener by speaking",
        "Tell is subtle but observable",
        "gdlint src/ passes"
      ],
      "priority": 30,
      "passes": false,
      "notes": "Behavioral evidence: voice-reactive = likely Listener"
    },
    {
      "id": "FW-046-09",
      "title": "Implement counterplay: whisper mode awareness",
      "description": "Help players know when to be quiet",
      "acceptanceCriteria": [
        "HUD indicator shows proximity to Listener (optional)",
        "OR: rely on dormant audio cue only",
        "Document whisper threshold in game hints",
        "Push-to-talk users naturally safer",
        "Open mic users need voice discipline",
        "gdlint src/ passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": "Counterplay through awareness and caution"
    },
    {
      "id": "FW-046-10",
      "title": "Implement hunt cooldown for voice triggers",
      "description": "Prevent repeated instant hunts",
      "acceptanceCriteria": [
        "After voice-triggered hunt, cooldown applies",
        "Cooldown: 60 seconds (configurable)",
        "During cooldown, voice doesn't trigger hunt",
        "Normal hunts still possible during cooldown",
        "gdlint src/ passes"
      ],
      "priority": 32,
      "passes": false,
      "notes": "Prevents infinite hunt loops"
    },
    {
      "id": "FW-046-11",
      "title": "Register Listener in EntityManager",
      "description": "Add Listener to entity registry",
      "acceptanceCriteria": [
        "Add Listener to EntityManager.ENTITY_TYPES dictionary",
        "Configure evidence type mapping",
        "Listener selectable for match (random or configured)",
        "Entity-evidence matrix includes Listener",
        "gdlint src/ passes"
      ],
      "priority": 33,
      "passes": false,
      "notes": "EntityManager at src/entity/entity_manager.gd"
    },
    {
      "id": "FW-046-12",
      "title": "Create Listener 3D model placeholder",
      "description": "Visual representation of Listener entity",
      "acceptanceCriteria": [
        "Create placeholder mesh for Listener",
        "Distinct from other entity designs",
        "Humanoid but unsettling appearance",
        "Translucent/ghostly material",
        "Visible during manifestation and hunt",
        "gdlint scenes/ passes"
      ],
      "priority": 34,
      "passes": false,
      "notes": "Placeholder model; art pass later"
    },
    {
      "id": "FW-046-13",
      "title": "Add Listener-specific sounds",
      "description": "Audio design for Listener",
      "acceptanceCriteria": [
        "Create/acquire dormant hum sound effect",
        "Create/acquire voice-trigger reaction sound",
        "Hunt approach sound (different from other entities)",
        "Sounds added to AudioManager pools",
        "gdlint src/ passes"
      ],
      "priority": 35,
      "passes": false,
      "notes": "Placeholder sounds; audio polish later"
    },
    {
      "id": "FW-046-14",
      "title": "Write unit tests for Listener",
      "description": "Test Listener-specific mechanics",
      "acceptanceCriteria": [
        "Create tests/unit/test_listener_entity.gd",
        "Test dormant/active phase cycling",
        "Test voice detection threshold",
        "Test voice-triggered hunt initiation",
        "Test hunt cooldown behavior",
        "All tests pass",
        "gdlint tests/ passes"
      ],
      "priority": 36,
      "passes": false,
      "notes": "File: tests/unit/test_listener_entity.gd"
    },
    {
      "id": "FW-046-15",
      "title": "Write integration tests for Listener",
      "description": "Test Listener in game context",
      "acceptanceCriteria": [
        "Create tests/integration/test_listener_integration.gd",
        "Test voice activity triggering hunt",
        "Test dormant audio cue audibility",
        "Test behavioral tell observability",
        "Test evidence generation",
        "All tests pass",
        "gdlint tests/ passes"
      ],
      "priority": 37,
      "passes": false,
      "notes": "File: tests/integration/test_listener_integration.gd"
    }
  ]
}
