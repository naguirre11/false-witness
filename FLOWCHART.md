# Claude Code Workflow Flowchart

A decision tree for approaching work systematically. Follow this at the start of every session when `%flowchart` / `%f` is invoked.

---

### Session Context (Auto-Generated)

The file `cc_workflow/session_start.md` is auto-generated by a SessionStart hook each time Claude Code starts. It contains a snapshot of project state at session start:

| Variable | Description |
|----------|-------------|
| **Active Ticket** | Ticket currently in `dev_in_progress/` (should be only one) |
| **Next Ticket** | Ticket marked as NEXT in `STATUS.md` - pick this up if no active ticket |
| **Last Handoff** | Most recent session summary file and its summary line |
| **Test Status** | Result of last GUT test run (PASSED/FAILED/NONE) with counts |
| **Git Status** | Current branch and count of uncommitted files |
| **Ticket Counts** | Number of tickets in each status folder |
| **Blockers** | Any documented blockers in `handoffs/blockers/` |

**Read `cc_workflow/session_start.md` first** to understand the current state before proceeding with the flowchart steps.

---

## Phase 1: Session Initialization

### Step 1: Review session context
Read `cc_workflow/session_start.md` (auto-generated at session start).

IF handoff summary needs more detail:
  → Read the full handoff file listed in session_start.md

### Step 2: Check for emergencies
IF handoff indicates EMERGENCY or BLOCKER (broken build, critical bug, blocking issue):
  → Address the emergency FIRST
  → Skip to Phase 3

### Step 3: Check for non-ticketed work
IF handoff indicates NON-TICKETED work (user request, investigation needed):
  → Confirm with user if this is still the priority
  → IF confirmed: Proceed with that work
  → ELSE: Continue to Phase 2

ELSE:
  → Continue to Phase 2

---

## Phase 2: Ticket Selection

### Step 4: Check for active ticket
Check `tickets/dev_in_progress/` folder.

IF there is a ticket in dev_in_progress:
  → This is your active ticket
  → Skip to Phase 3

ELSE:
  → Continue to Step 5

### Step 5: Select next ticket
Read `tickets/STATUS.md` and find the NEXT ticket.

### Step 6: Verify dependencies
Check `tickets/PRIORITIZATION_ROADMAP.md` "Blocked By" column for the NEXT ticket.

IF dependencies are NOT satisfied:
  → Find the highest-priority unblocked ticket
  → Update NEXT in STATUS.md if needed

### Step 7: Move ticket to dev_in_progress
Run:
```
powershell -ExecutionPolicy Bypass -File cc_workflow/scripts/ticket-move.ps1 FW-XXX dev_in_progress
```

→ Continue to Phase 3

---

## Phase 3: Pre-Work Verification

### Step 8: Read the full ticket file
Read the ticket markdown file completely.

### Step 9: Evaluate ticket sizing
A well-sized ticket should have:
- 3-8 acceptance criteria
- Completable in one focused session
- Limited file scope (roughly 1-5 files)
- A single clear deliverable

Red flags (too large):
- 10+ acceptance criteria
- Multiple unrelated systems
- "Implement entire X system" scope
- Would require multiple handoffs to complete

IF ticket is NOT discrete and task-sized:
  → Break into sub-tickets:
    1. Create sub-tickets in `tickets/draft/`
    2. Each sub-ticket should have 3-5 acceptance criteria
    3. Add dependencies between sub-tickets
    4. Update STATUS.md with new tickets
    5. Original ticket becomes an epic or is replaced by sub-tickets
    6. Move first sub-ticket to dev_in_progress
  → Return to Step 8 with the first sub-ticket

ELSE:
  → Continue to Step 10

### Step 10: Check for design decisions
IF there are DESIGN DECISIONS needed (ambiguous requirements, multiple valid approaches, missing technical details, architectural questions):
  → ASK USER before proceeding
  → Document decisions in ticket's Technical Notes section
  → Continue to Step 11

ELSE:
  → Continue to Step 11

### Step 11: Check for external blockers
IF there are EXTERNAL BLOCKERS (missing assets, waiting on user input, third-party dependencies, unclear GDD requirements):
  → Document blocker in `handoffs/blockers/`
  → Notify user
  → Pick different ticket or wait for resolution
  → Return to Step 4

ELSE:
  → Continue to Step 12

### Step 12: Verify understanding
IF you do NOT fully understand the ACCEPTANCE CRITERIA:
  → Re-read ticket
  → Check GDD if referenced
  → Ask user for clarification if still unclear
  → Do not proceed until criteria are clear

ELSE:
  → Continue to Phase 4

---

## Phase 4: Implementation

### Step 13: Create implementation plan
- Break work into subtasks
- Use TodoWrite to track progress
- Identify files to create/modify

### Step 14: Implement incrementally
- Write code
- Test after each significant change
- Run `$GODOT --headless --import` after adding new scripts
- Run `gdlint` / `gdformat` before committing

### Step 15: Handle new requirements
IF implementation reveals NEW REQUIREMENTS (scope creep, unexpected complexity, missing features):
  → IF small and directly related to current ticket:
      → Include in current ticket
  → ELSE:
      → Create new ticket in `tickets/draft/`
      → Continue current work without the new scope

### Step 16: Check acceptance criteria
IF ALL acceptance criteria are met:
  → Continue to Phase 5

ELSE:
  → Return to Step 14

---

## Phase 5: Completion

### Step 17: Run final verification
Execute:
- `gdlint src/ tests/`
- `gdformat --check src/ tests/`
- `$GODOT --headless -s addons/gut/gut_cmdln.gd -gdir=res://tests -ginclude_subdirs -gprefix=test_ -gsuffix=.gd -gexit`
- Manual testing if applicable

IF tests fail OR lint errors exist:
  → Fix issues
  → Return to Step 14

ELSE:
  → Continue to Step 18

### Step 18: Update ticket with implementation notes
Add to the ticket file:
- What was done
- Test commands and evidence of success
- Any deviations from original plan

### Step 19: Move ticket to for_review
Run:
```
powershell -ExecutionPolicy Bypass -File cc_workflow/scripts/ticket-move.ps1 FW-XXX for_review
```

### Step 20: Update NEXT pointer
Edit `tickets/STATUS.md` and set NEXT to the highest-priority unblocked ticket.

→ Continue to Phase 6

---

## Phase 6: Handoff & Commit

### Step 21: Create session handoff
Create file: `handoffs/session_summaries/YYYY-MM-DD-HH.md`

Include:
- Summary of work done
- Files changed
- Current state
- Next steps
- Open questions (if any)

### Step 22: Commit changes
Run:
```
git add . && git commit -m "feat/fix: description"
```
Note: NO Claude references in commit message.

### Step 23: Push to remote (if requested)
IF user requests push:
  → Run `git push`

→ DONE - Ready for next session or next ticket

---

## Quick Reference: Key Questions

| Step | Question | IF YES | IF NO |
|------|----------|--------|-------|
| 2 | Emergency in handoff? | Handle immediately | Continue |
| 4 | Ticket in dev_in_progress? | Resume that ticket | Pick from NEXT |
| 6 | Dependencies satisfied? | Proceed | Find unblocked ticket |
| 9 | Ticket discrete & task-sized? | Proceed | Break into sub-tickets |
| 10 | Design decisions needed? | Ask user first | Proceed |
| 11 | External blockers? | Document & notify | Proceed |
| 15 | Scope creep discovered? | New ticket if big | Include if small |
| 16 | Acceptance criteria met? | Move to completion | Continue work |
| 17 | Tests/lint pass? | Proceed to handoff | Fix issues first |

---

## Anti-Patterns to Avoid

1. **Starting work without reading the handoff** - You might duplicate work or miss context
2. **Ignoring blockers** - Don't force through; document and escalate
3. **Skipping design decisions** - Assumptions lead to rework
4. **Working on blocked tickets** - Check dependencies first
5. **Tackling oversized tickets** - Break them up first; large tickets lead to incomplete handoffs
6. **Forgetting to update STATUS.md** - Next session won't know the state
7. **Committing without testing** - Run lint + tests before every commit
8. **Scope creep without new tickets** - Large additions need their own tickets
9. **Empty handoffs** - Always document what you did, even if incomplete
